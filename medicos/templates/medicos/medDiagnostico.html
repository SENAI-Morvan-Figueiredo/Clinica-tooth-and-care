{% extends "baseMed.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center fw-bold mb-4" style="color: #2C8E89;">
        Detalhes da Consulta
    </h2>

    <!-- Info da consulta -->
    <div class="card shadow-sm mb-4 border-0">
        <div class="card-body">
            <p><strong>Data e Hora:</strong> {{ consulta.data|date:"d/m/Y H:i" }}</p>
            <p><strong>Paciente:</strong> {{ consulta.paciente.user.get_full_name }}</p>
            <p><strong>Serviço:</strong> {{ consulta.get_servico_display }}</p>
            <p><strong>Sala:</strong> {{ consulta.sala }}</p>
            <p><strong>Valor:</strong> R$ {{ consulta.valor|floatformat:2 }}</p>
            <p><strong>Status:</strong> {{ consulta.get_status_display }}</p>
        </div>
    </div>

    <!-- Diagnóstico e Anamnese lado a lado -->
    <div class="row">
        <!-- Diagnósticos -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0 mb-4 h-100">
                <div class="card-header bg-teal text-white sticky-top" style="background-color:#2C8E89;">
                    <strong>Diagnósticos</strong>
                </div>
                <div class="card-body scrollable-card">
                    {% if diagnostico %}
                        <ul class="list-group mb-3">     
                            <li class="list-group-item">
                                <strong>{{ diagnostico.tipo }}</strong><br>
                                <em>Plano de tratamento:</em> {{ diagnostico.plano_de_tratamento }}<br>
                                <em>Detalhes:</em> {{ diagnostico.detalhes }}
                            </li>
                        </ul>
                    {% else %}
                        <p class="text-muted">Nenhum diagnóstico registrado.</p>
                    {% endif %}

                    <hr>
                    <h6 class="fw-bold text-teal mt-3">Novo Diagnóstico</h6>
                    <form method="POST" class="custom-form">
                        {% csrf_token %}
                        {{ diagnostico_form.as_p }}
                        <button type="submit" name="submit_diagnostico" class="btn btn-success w-100 mt-2">
                            Salvar Diagnóstico
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Anamnese -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0 mb-4 h-100">
                <div class="card-header bg-teal text-white sticky-top" style="background-color:#2C8E89;">
                    <strong>Anamnese</strong>
                </div>
                <div class="card-body scrollable-card">
                    {% if anamnese %}
                        <p><strong>Queixa principal:</strong> {{ anamnese.queixa_principal }}</p>
                        <p><strong>Doenças crônicas:</strong> {{ anamnese.doencas_cronicas }}</p>
                        <p><strong>Medicamentos:</strong> {{ anamnese.medicamentos }}</p>
                        <p><strong>Histórico:</strong> {{ anamnese.historico }}</p>
                        <p><strong>Alergia:</strong> {{ anamnese.alergia }}</p>
                        <p><strong>Observação:</strong> {{ anamnese.observacao }}</p>
                    {% else %}
                        <p class="text-muted">Nenhuma anamnese registrada.</p>
                        <hr>
                        <h6 class="fw-bold text-teal mt-3">Nova Anamnese</h6>
                        <form method="POST" class="custom-form">
                            {% csrf_token %}
                            {{ anamnese_form.as_p }}
                            <button type="submit" name="submit_anamnese" class="btn btn-success w-100 mt-2">
                                Salvar Anamnese
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-end py-3">
        <a href="{% url 'finalizarConsulta' consulta.pk %}" class="btn btn-primary mt-2">Finalizar consulta</a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<style>
    body {
        background-color: #f8f9fa;
        font-family: "Inter", sans-serif;
    }

    .text-teal {
        color: #2C8E89;
    }

    .card {
        border-radius: 12px;
        overflow: hidden;
    }

    /* Define altura e rolagem suave */
    .scrollable-card {
        max-height: 450px;
        overflow-y: auto;
        padding-right: 10px;
    }

    .scrollable-card::-webkit-scrollbar {
        width: 8px;
    }
    .scrollable-card::-webkit-scrollbar-thumb {
        background-color: #2C8E89;
        border-radius: 10px;
    }

    .scrollable-card::-webkit-scrollbar-track {
        background: #e9ecef;
        border-radius: 10px;
    }

    .custom-form p {
        margin-bottom: 10px;
    }

    .custom-form input, 
    .custom-form select, 
    .custom-form textarea {
        width: 100%;
        border: 1px solid #ced4da;
        border-radius: 6px;
        padding: 8px 10px;
        font-size: 0.95rem;
        transition: 0.2s ease-in-out;
    }

    .custom-form input:focus, 
    .custom-form select:focus, 
    .custom-form textarea:focus {
        border-color: #2C8E89;
        box-shadow: 0 0 5px rgba(44, 142, 137, 0.3);
        outline: none;
    }

    .btn-success {
        background-color: #2C8E89;
        border: none;
        font-weight: 600;
        transition: 0.2s ease-in-out;
    }

    .btn-success:hover {
        background-color: #256f6b;
    }
</style>
{% endblock %}
